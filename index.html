<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/SimplifyX Logo_Icon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SimplifyX</title>
</head>

<body>
  <div id="root"></div>
  <script>
(function () {
  const originalLog = console.log;
  console.log = function (...args) {
    const joined = args.join(' ');
    if (joined.includes('server connection lost') || joined.includes('failed to connect to websocket')) {
      window.parent?.postMessage({ type: 'vite-server-lost', message: joined }, '*');
    }
    originalLog.apply(console, args);
  };

  const originalInfo = console.info;
  console.info = function (...args) {
    const joined = args.join(' ');
    if (joined.includes('building for production')) {
      window.parent?.postMessage({ type: 'vite-build-start', message: joined }, '*');
    } else if (joined.includes('âœ“ built in')) {
      window.parent?.postMessage({ type: 'vite-build-complete', message: joined }, '*');

      fetch('/dist/manifest.json')
        .then(res => (res.ok ? res.text() : null))
        .then(content => {
          if (content) {
            window.parent?.postMessage({
              type: 'vite-dist-ready',
              distFiles: content,
            }, '*');
          }
        })
        .catch(() => {});
    }
    originalInfo.apply(console, args);
  };

  if (typeof WebSocket !== 'undefined') {
    const originalWebSocket = window.WebSocket;
    window.WebSocket = function(url, protocols) {
      const ws = new originalWebSocket(url, protocols);
      
      const originalOnMessage = ws.onmessage;
      ws.onmessage = function(event) {
        try {
          const data = JSON.parse(event.data);
          if (data.type === 'error') {
            console.log('Vite WebSocket error:', data);
            window.parent?.postMessage({
              type: 'vite-websocket-error',
              message: data.err?.message || 'Vite error',
              stack: data.err?.stack,
              id: data.err?.id,
              loc: data.err?.loc,
              frame: data.err?.frame,
            }, '*');
          }
        } catch (e) {
        }
        
        if (originalOnMessage) {
          originalOnMessage.call(this, event);
        }
      };
      
      return ws;
    };
  }

  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      mutation.addedNodes.forEach((node) => {
        if (node.nodeType === Node.ELEMENT_NODE) {
          const element = node;
          if (element.id === 'vite-error-overlay' || 
              element.getAttribute('data-vite-overlay') !== null ||
              element.tagName === 'VITE-ERROR-OVERLAY') {
            const errorContent = element.textContent || element.innerHTML;
            window.parent?.postMessage({
              type: 'vite-overlay-error',
              message: errorContent,
            }, '*');
          }
        }
      });
    });
  });

  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
})();
</script>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>